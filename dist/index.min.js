"use strict";var __awaiter=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(o,n){function c(e){try{i(r.next(e))}catch(e){n(e)}}function a(e){try{i(r.throw(e))}catch(e){n(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(c,a)}i((r=r.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.useFetchWithProgress=void 0;const react_1=require("react"),useFetchWithProgress=()=>{const[e,t]=(0,react_1.useState)(0),[s,r]=(0,react_1.useState)(0),[o,n]=(0,react_1.useState)(null);return{progress:e,eta:s,response:o,fetchWithProgress:(e,s,o)=>_fetchWithProgress(e,s,o,{setProgress:t,setETA:r,setResponse:n})}};exports.useFetchWithProgress=useFetchWithProgress;const _fetchWithProgress=(e="",t={},s=()=>{},{setProgress:r,setETA:o,setResponse:n})=>{const c=fetch(e,t);return _processReponse(c,s,{setProgress:r,setETA:o,setResponse:n}),c},_processReponse=(e,t,s)=>__awaiter(void 0,[e,t,s],void 0,(function*(e,t,{setProgress:s,setETA:r,setResponse:o}){var n;const c=yield e;o(c);const a=c.clone(),i=null===(n=a.body)||void 0===n?void 0:n.getReader();if(!i)return;const u=+(a.headers.get("content-length")||0);let h=0,p=[];const f=performance.now();for(;;){const{done:e,value:o}=yield i.read(),n=performance.now()-f;if(e){s(100),r(0);break}p.push(o),h+=o.length;const c=100*h/u,a=n*(u-h)/h;s(c),r(a),t({progress:c,eta:a})}}));exports.default=useFetchWithProgress;